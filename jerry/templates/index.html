<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% block title %}{% endblock %}</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="shortcut icon" href="/static/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/datetimepicker.css">
    <link rel="stylesheet" href="/static/css/bootstrap-datetimepicker.css">
    <link rel="stylesheet" href="/static/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/css/animate.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/table.css">
    <script src="/static/js/jquery-2.2.3.min.js"></script>
    <script src="/static/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/js/bootstrap-datetimepicker.js"></script>
    <script src="/static/js/main.js"></script>
    <script src="/static/js/options.js"></script>
    <script src="/static/js/modernizr-2.6.2.min.js"></script>
</head>

    {% block container %}
<body>
    <section id="container">
        <header id="header">
            <div class="brand">
                <a href="{% url 'index' %}" class="logo">
                    <span>OMS</span></a>
            </div>
            <div class="user-nav">
                <ul>
                    <li class="dropdown messages">
                        <span class="badge badge-danager animated bounceIn" id="new-messages"></span>
                        <button type="button" class="btn btn-default dropdown-toggle options" id="toggle-mail" data-toggle="dropdown">
                            <i class="fa fa-envelope"></i>
                        </button>
                    </li>
                    <li class="profile-photo">
                        <img src="/static/img/avatar.png" alt="" class="img-circle">
                    </li>
                    <li class="dropdown settings">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                      {{ user|capfirst }} <i class="fa fa-angle-down"></i>
                    </a>
                        <ul class="dropdown-menu animated fadeInDown">
                            <li>
                                <a href="" data-toggle="modal" data-target="#modal-user"><i class="fa fa-user"></i> Profile</a>
                            </li>
                            <li>
                                <a href="{% url 'logout' %}"><i class="fa fa-power-off"></i> Logout</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>

<div class="modal fade bs-example-modal-xs" id="modal-user" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title text-center">个人信息</h4>
      </div>
      <div class="modal-body ">
          <div class="table-responsive">
            <table class="table table-hover table-bordered table-striped">
                    <tbody>
                        <tr>
                            <td>用户名：</td>
                            <td>{{ user.username }}</td>
                        </tr>
                        <tr>
                            <td>姓氏：</td>
                            <td>{{ user.first_name }}</td>
                        </tr>
                        <tr>
                            <td>名字：</td>
                            <td>{{ user.last_name }}</td>
                        </tr>
                        <tr>
                            <td>邮箱：</td>
                            <td>{{ user.email }}</td>
                        </tr>
                        <tr>
                            <td>注册时间：</td>
                            <td>{{ user.date_joined }}</td>
                        </tr>
                        <tr>
                            <td>最后登录时间：</td>
                            <td>{{ user.last_login }}</td>
                        </tr>
                    </tbody>
            </table>
          </div>
      </div>
      <div class="modal-footer">
          <a class="btn btn-primary" href="{% url 'password_change' %}" >
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> 修改密码
          </a>
        <button type="button" class="btn btn-primary" data-dismiss="modal">
            <span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span> 关闭
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

        </header>


        {% block header %}

        <aside class="sidebar">
            <div id="leftside-navigation" class="nano">
                <ul class="nano-content">
                    <li class="sub-menu">
                        <a href="javascript:void(0);"><i class="fa fa-table"></i><span>CMDB</span><i class="arrow fa fa-angle-right pull-right"></i></a>
                        <ul class="left_nav">
                            <li><a id="cmdb_group" href="{% url 'cmdb:aliyunecs' %}">AliYunECS管理</a>
                            </li>
                            <li><a id="cmdb_asset" href="{% url 'cmdb:asset' %}">IDC资产管理</a>
                            </li>
                            <li><a id="cmdb_idc" href="{% url 'cmdb:idc' %}">机房管理</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sub-menu">
                        <a href="javascript:void(0);"><i class="fa fa-table"></i><span>配置管理</span><i class="arrow fa fa-angle-right pull-right"></i></a>
                        <ul>
                            <li><a href="{% url 'disconf:ansiblefile' %}">配置文件</a>
                            </li>
                            <li><a href="{% url 'disconf:ansiblerun' %}">执行命令</a>
                            </li>
                            <li><a href="{% url 'disconf:ansiblejobrun' %}">Jobs</a>
                            </li>
                            <li><a href="{% url 'cmdb:test' %}">Table</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sub-menu">
                        <a href="javascript:void(0);"><i class="fa fa-table"></i><span>数据信息</span><i class="arrow fa fa-angle-right pull-right"></i></a>
                        <ul>
                            <li><a href="{% url 'opera:db_info' %}">数据库信息</a>
                            </li>
                            <li><a href="{% url 'opera:db_opera' %}">数据库操作</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sub-menu">
                        <a href="javascript:void(0);"><i class="fa fa-table"></i><span>监控平台</span><i class="arrow fa fa-angle-right pull-right"></i></a>
                        <ul>
                            <li><a href="{% url 'opera:db_info' %}">数据库信息</a>
                            </li>
                            <li><a href="{% url 'opera:db_opera' %}">数据库操作</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sub-menu">
                        <a href="javascript:void(0);"><i class="fa fa-file"></i><span>Pages</span><i class="arrow fa fa-angle-right pull-right"></i></a>
                        <ul>
                            <li><a href="{% url 'logout' %}">Logout</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </aside>

        <section class="main-content-wrapper">
            <section id="main-content">
		{% block content %}

                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-tile detail tile-red">
                            <div class="content">
                                <h1 class="text-left timer" data-from="0" data-to="180" data-speed="2500">21</h1>
                                <p>New Users</p>
                            </div>
                            <div class="icon"><i class="fa fa-users"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-tile detail tile-turquoise">
                            <div class="content">
                                <h1 class="text-left timer" data-from="0" data-to="56" data-speed="2500">21</h1>
                                <p>New Comments</p>
                            </div>
                            <div class="icon"><i class="fa fa-comments"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-tile detail tile-blue">
                            <div class="content">
                                <h1 class="text-left timer" data-from="0" data-to="32" data-speed="2500">21</h1>
                                <p>New Messages</p>
                            </div>
                            <div class="icon"><i class="fa fa fa-envelope"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-tile detail tile-purple">
                            <div class="content">
                                <h1 class="text-left timer" data-to="105" data-speed="2500">21</h1>
                                <p>New Sales</p>
                            </div>
                            <div class="icon"><i class="fa fa-bar-chart-o"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">本机CPU负载</h3>
                                <div class="actions pull-right">
                                    <i class="fa fa-chevron-down"></i>
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="cpuinfo" style="height: 300px;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Ansible 主机检测</h3>
                                <div class="actions pull-right">
                                    <i class="fa fa-chevron-down"></i>
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div class="col-md-8" id="ansiblecheck" style="height: 300px;"></div>
                                <div class="col-md-4" id="checklist" style="height: 300px;">
 <table class="table" id="ansibleinfo">
  <caption><h4>最新运行情况</h4></caption>
  <thead>
    <tr>
      <th>主机</th>
      <th>检测状态</th>
    </tr>
  </thead>
  <tbody>
    <!--<tr>
      <td>Tanmay</td>
      <td>Bangalore</td>
    </tr>
    <tr>
      <td>Sachin</td>
      <td>Mumbai</td>
    </tr>
    <tr>
      <td>Sachin</td>
      <td>Mumbai</td>
    </tr>
    <tr>
      <td>Sachin</td>
      <td>Mumbai</td>
    </tr>
    <tr>
      <td>Sachin</td>
      <td>Mumbai</td>
    </tr>-->
  </tbody>
</table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



<script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
<script type="text/javascript">
require.config({
    paths: {
        echarts: 'http://echarts.baidu.com/build/dist'
        }
        });

require(
    [
        'echarts',
        'echarts/chart/gauge', 
    ],
function (ec) {
    var myChart = ec.init(document.getElementById('cpuinfo'),'shine');

var option = {
    tooltip : {
        formatter: "{a} <br/>{c} {b}"
    },
    //title:{
    //    text : "本机CPU负载",
    //},
    toolbox: {
        show : true,
        feature : {
            //mark : {show: true},
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },
    series : [

        {
            name:'cpu load',
            type:'gauge',
            center : ['20%', '50%'],    // 默认全局居中
            radius : '60%',
            min:0,
            max:10,
            splitNumber:10,
            axisLine: {            // 坐标轴线
                lineStyle: {       // 属性lineStyle控制线条样式
                    color: [
                    //[0.2, '#228b22'],
                    //[0.7, '#006699'],
                    //[1, '#ff4500'],
                    ],
                    width: 6
                }
            },
            axisTick: {            // 坐标轴小标记
                length :15,        // 属性length控制线长
                lineStyle: {       // 属性lineStyle控制线条样式
                    color: 'auto'
                }
            },
            splitLine: {           // 分隔线
                length :20,         // 属性length控制线长
                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                    color: 'auto'
                }
            },
            title : {
                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    fontWeight: 'bolder',
                    fontSize: 20,
                    fontStyle: 'italic'
                }
            },
            detail : {
                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    fontWeight: 'bolder'
                }
            },
            data:[{value: 10, name: '1min'}]
        },

        {
            name:'cpu load',
            type:'gauge',
            radius : '60%',
            z: 3,
            min:0,
            max:10,
            splitNumber:10,
            axisLine: {            // 坐标轴线
                lineStyle: {       // 属性lineStyle控制线条样式
                    width: 6
                }
            },
            axisTick: {            // 坐标轴小标记
                length :15,        // 属性length控制线长
                lineStyle: {       // 属性lineStyle控制线条样式
                    color: 'auto'
                }
            },
            splitLine: {           // 分隔线
                length :20,         // 属性length控制线长
                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                    color: 'auto'
                }
            },
            title : {
                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    fontWeight: 'bolder',
                    fontSize: 20,
                    fontStyle: 'italic'
                }
            },
            detail : {
                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    fontWeight: 'bolder'
                }
            },
            data:[{value: 10, name: '5min'}]
        },

        {
            name:'cpu load',
            type:'gauge',
            center : ['80%', '50%'],    // 默认全局居中
            radius : '60%',
            z: 3,
            min:0,
            max:10,
            splitNumber:10,
            axisLine: {            // 坐标轴线
                lineStyle: {       // 属性lineStyle控制线条样式
                    width: 6
                }
            },
            axisTick: {            // 坐标轴小标记
                length :15,        // 属性length控制线长
                lineStyle: {       // 属性lineStyle控制线条样式
                    color: 'auto'
                }
            },
            splitLine: {           // 分隔线
                length :20,         // 属性length控制线长
                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                    color: 'auto'
                }
            },
            title : {
                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    fontWeight: 'bolder',
                    fontSize: 20,
                    fontStyle: 'italic'
                }
            },
            detail : {
                textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                    fontWeight: 'bolder'
                }
            },
            data:[{value: 10, name: '15min'}]
        },
    ]
};

clearInterval(timeTicket);
var timeTicket = setInterval(function (){
    $.getJSON("/proc/cpuinfo",function(result,date){
        $.each(result,function(n,vat){
            option.series[n].data[0].value = vat;
        });
    myChart.setOption(option,true);
   });
    
},2000)
});
</script>

<script type="text/javascript">
require.config({
    paths: {
        echarts: 'http://echarts.baidu.com/build/dist'
        }
        });
require(
    [
        'echarts',
        'echarts/chart/pie', 
    ],
function (ecs) {
    var myChart = ecs.init(document.getElementById('ansiblecheck'));
var option = {
    tooltip : {
        trigger: 'item',
        formatter: "{a} <br/>{b} : {c} ({d}%)"
    },
    legend: {
        orient : 'vertical',
        x : 'left',
        data:['Success','Failed','Unknown']
    },
    toolbox: {
        show : true,
        feature : {
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },
    calculable : true,
    series : [
        {
            name:'访问来源',
            type:'pie',
            radius : ['50%', '70%'],
            itemStyle : {
                normal : {
                    label : {
                        show : false
                    },
                    labelLine : {
                        show : false
                    }
                },
                emphasis : {
                    label : {
                        show : true,
                        position : 'center',
                        textStyle : {
                            fontSize : '30',
                            fontWeight : 'bold'
                        }
                    }
                }
            },
            data:[
                {value:335, name:'Success'},
                {value:310, name:'Failed'},
                {value:234, name:'Unknown'},
            ]
        }
    ]
};

    myChart.showLoading();
    $.getJSON("/proc/ansiblecheck",function(result,date){
        $.each(result[1],function(n,vat){
            option.series[0].data[n].value = vat;
        });
        function getRow(row) {
            var tr = $('<tr></tr>');
            for(var i in row) {
                tr.append('<td>' + row[i] + '</td>');
            }
            return tr;
        }
        var tbody = $('<tbody></tbody>');
        for(var i = 0; i < 5; i ++ ){
            tbody.append(getRow(result[0][i]));
            //alert(result[0][i]);
        }
        $('#ansibleinfo tbody').replaceWith(tbody);
    myChart.hideLoading();
    myChart.setOption(option,true);
   });
});
</script>


       {% endblock %}
       </section>
      </section>
     {% endblock %}
    </section>
    <script src="/static/plugins/waypoints/waypoints.min.js"></script>
    <script src="/static/js/application.js"></script>
    <script src="/static/plugins/nanoScroller/jquery.nanoscroller.min.js"></script>
    <script src="/static/plugins/countTo/jquery.countTo.js"></script>
    <script src="/static/plugins/weather/js/skycons.js"></script>

</body>
{% endblock %}
</html>
